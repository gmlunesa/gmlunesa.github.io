{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-js","path":"/blog/creating-a-wholesome-chat-space-with-tensorflow/","result":{"data":{"markdownRemark":{"html":"<p>Along with the growing accessibility of the internet across the world, offensive actions across the virtual space have also become increasingly prevalent. According to <a href=\"https://www.pewresearch.org/internet/2021/01/13/the-state-of-online-harassment/\">Pew Research</a>, roughly 4 in 10 Americans have experienced online harrassment. Through machine learning, we can help to improve user experience to avoid negative interactions.</p>\n<p class=\"my-6\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/1b3e5690146ef1c7767e40ffb2bc615b/31aa8/NotoxShowcase.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 91.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEN0lEQVQ4y4WTCUzbVRzHf6XOKDK2xWAkYgTnkZAxyYCMY8AYkGFXHIxxTW4YlyApmeIyFAjbUCYyAYlmc0Qm4EBGJFJuCHQWWo6WXqwnbaGlXBtlTFiP/89AgrGSjG/y8r4vee+T936/9wX4j06FhMOrDu+C7WuOwGJzgc8SQJjfOTjh7A/1FXVAb+78dy/lTBTsKU/f06T9do5gfcjBkfbZl3/m0woHPN1Ptbkf9bubGJN+p7CgNAERYWsEBoftDQyiRJCpIVHgf5KaRCsuQcrVfDxSnI7Ol1MwuLYQs2pvmCLeCbbP9roAMSmZpD2BAafDyOdD4yGUEnv+w+QEjLhGM7TMsIzVnA5jJbfDXNXR8uwj/wiX5LOp8HFattWeQJ8ACtnLmwKevlRqVFIilpYXEbJVHcGaFREivZpg8CbQ2yckkHImBmIT0/cGengHWR12PAbvve8ZEJuRgV98X0ywhCKCK3hIyDUL5vFpIfoFhUaGRydCVHwa2c7e6fnAo26+VjZgB/b7nVzCMjMMYV9fQp5GQTAVfGJMJzGx5CKMjEmJy8y+BBdz8skOTs7PBx45dmK70FZg/WZkRtbflJJc5GhkxIiST3CWFEa2XITZuZ/nFFwphZLrVfvobWLSKEMHg53LpCn2OnBZ65bAD9z9djp3KDoja+3k5Ys4PDFJ9A2MEKPjAsOUTIoFX5UW5hUWAa3SjVR5nQtK+QK5h64HPt8EPJ7REujq4b9jreMyc+aP58fjEJdjnuSLUahQGXhKGRaV3ywfYTDhxyr2wcqyyQNKxRL09+jf4AtMNgKBcdcNd+yLiZmfSjxyLyBDNmX+a1ZIDGv45hGtGHvv/DSPbHr4CEORymHKaPpl6dstVcK64d/ngwd/0+5qyo61ikv7ZMIrLx67hSyTTD+PDx/PoXxzlRA0/YKLDwZwUbf4bEGt3ny0qkedVDU182sjVVx7e1dTtuetaMUkpg/65CVgK3vAuLz5xCzXKE0cIcfEGxs3yLh8o2JaQmhm1MbR2z/jREMDHxHJW+cs5OzqDTtZPRedRKdeycE/RoaM6xtGlHCmsL26CnkcLs5Mi1EunEatUo0DV6/h0LcVIkR85XUAyzi6uvtDclaeVXxqNgQEn60pq67Fpvvt2Hivbami5pawq/qHHi69u04jkU5rxVKZViIVL8/r5h4trRQv3W3yftzdZ2sBbPmmAaiB0aRg//Ct5Qs2B986DgCHAcBmuxTrT0E6Pgn8W/XW4vbOA/KuPlvOzRqbrRepHjCh7P8fe6V1GszNKsDOlZc0Ldz6NbaqFZ9uNiOauhDRz4wICyrVPnF9EyjovaDo6gclvRcWV1ZI+rV1EN/4zhLI6x+FWRXCxga+zL7fqh9jduMT7RgSehmaNlbi0LAKuLFInmEwQTU6RlKzx0lzY5Mk7eQU6FzcQNt4D/4Bhd1TzN76M1cAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\".NET MAUI app mockup\" title=\".NET MAUI app mockup\" src=\"/static/1b3e5690146ef1c7767e40ffb2bc615b/5a190/NotoxShowcase.png\" srcset=\"/static/1b3e5690146ef1c7767e40ffb2bc615b/772e8/NotoxShowcase.png 200w,\n/static/1b3e5690146ef1c7767e40ffb2bc615b/e17e5/NotoxShowcase.png 400w,\n/static/1b3e5690146ef1c7767e40ffb2bc615b/5a190/NotoxShowcase.png 800w,\n/static/1b3e5690146ef1c7767e40ffb2bc615b/c1b63/NotoxShowcase.png 1200w,\n/static/1b3e5690146ef1c7767e40ffb2bc615b/29007/NotoxShowcase.png 1600w,\n/static/1b3e5690146ef1c7767e40ffb2bc615b/31aa8/NotoxShowcase.png 4202w\" sizes=\"(max-width: 800px) 100vw, 800px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</p>\n<h2>Using machine learning models</h2>\n<p>In this blog post, I will provide a walkthrough on how to integrate and use a machine learning model in a chat application to prevent rude messages from being sent. Of course, there is a simple option to identify toxic messages by checking if the message contains a word that is deemed inappropriate. However, this approach may overlook semantic context and may misclassify the message. Take these two sentences for example:</p>\n<ul>\n<li>The weather is <strong><mark>horrible</mark></strong>.</li>\n<li>You are <strong><mark>horrible</mark></strong>.</li>\n</ul>\n<p>If the word horrible was in the list of inappropriate words, the first sentence will be misclassified as toxic. Context <em>matters</em>, hence we will harness the power of machine learning to take this a step further.</p>\n<p>This project will be using a pre-trained TensorFlow model from <a href=\"https://www.tensorflow.org/js\">Tensorflow.js</a>. The model detects whether the text contains toxic content such as threatening language, insults, obscenities, identity-based hate, or explicit language. It is built on top of the Universal Sentence Encoder (<a href=\"https://arxiv.org/pdf/1803.11175.pdf\">Cer et al., 2018</a>), a model that encodes text into 512-dimensional embedding and uses the Transformer (<a href=\"https://arxiv.org/pdf/1706.03762.pdf\">Vaswani et al, 2017</a>) architecture, which is a state-of-the-art method for modelling language.</p>\n<p>The model will then be integrated to a React chat application that is bootstrapped with <a href=\"https://github.com/gmlunesa/techst/\">Techst</a>, a plug and play chat platform template.</p>\n<h2>Chat platform setup</h2>\n<ul>\n<li>\n<p>Clone the Techst repository (alternative: <a href=\"https://docs.github.com/en/repositories/creating-and-managing-repositories/creating-a-repository-from-a-template\">Create a repository from a template - GitHub Docs</a>)</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://github.com/gmlunesa/techst.git</code></pre></div>\n</li>\n<li>\n<p>Install Node modules</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span></code></pre></div>\n</li>\n<li>\n<p>Go to the <a href=\"https://console.firebase.google.com\">Firebase Console</a>.</p>\n<ul>\n<li>\n<p>Add a project.</p>\n</li>\n<li>\n<p>Add <code class=\"language-text\">Authentication</code> with <code class=\"language-text\">Email/Password</code> as the <code class=\"language-text\">Sign-in method</code>.</p>\n</li>\n<li>\n<p>Add a <code class=\"language-text\">Firestore Database</code>.</p>\n</li>\n<li>\n<p>Add a <code class=\"language-text\">Storage</code>.</p>\n</li>\n<li>\n<p>Add a <code class=\"language-text\">Web</code> application.</p>\n</li>\n<li>\n<p>Copy the Firebase configuration that has been generated.</p>\n</li>\n</ul>\n</li>\n<li>\n<p>Open the <code class=\"language-text\">firebase.sample.js</code> file, paste and replace the Firebase configuration under the <code class=\"language-text\">// TODO: Replace</code> comment.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"> <span class=\"token comment\">// TODO: Replace</span>\r\n <span class=\"token literal-property property\">apiKey</span><span class=\"token operator\">:</span> <span class=\"token string\">'YOUR_API_KEY'</span><span class=\"token punctuation\">,</span>\r\n <span class=\"token literal-property property\">authDomain</span><span class=\"token operator\">:</span> <span class=\"token string\">'YOUR_AUTH_DOMAIN'</span><span class=\"token punctuation\">,</span>\r\n <span class=\"token literal-property property\">projectId</span><span class=\"token operator\">:</span> <span class=\"token string\">'YOUR_PROJECT_ID'</span><span class=\"token punctuation\">,</span>\r\n <span class=\"token literal-property property\">storageBucket</span><span class=\"token operator\">:</span> <span class=\"token string\">'YOUR_STORAGE_BUCKET'</span><span class=\"token punctuation\">,</span>\r\n <span class=\"token literal-property property\">messagingSenderId</span><span class=\"token operator\">:</span> <span class=\"token string\">'YOUR_MESSAGING_SENDER_ID'</span><span class=\"token punctuation\">,</span>\r\n <span class=\"token literal-property property\">appId</span><span class=\"token operator\">:</span> <span class=\"token string\">'YOUR_APP_ID'</span><span class=\"token punctuation\">,</span></code></pre></div>\n</li>\n<li>\n<p>Rename the <code class=\"language-text\">firebase.sample.js</code> file to <code class=\"language-text\">firebase.js</code>.</p>\n</li>\n</ul>\n<h2>Tensorflow Integration</h2>\n<p>Now that the chat application is up and running, we can now incorporate Tensorflow in our app.</p>\n<ul>\n<li>\n<p>Install relevant Tensorflow packages</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> @tensorflow/tfjs @tensorflow-models/toxicity</code></pre></div>\n</li>\n<li>\n<p>Open <code class=\"language-text\">src/components/Input.js</code></p>\n</li>\n<li>\n<p>Import the load method from the Toxicity model.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Input.js</span>\r\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> load <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@tensorflow-models/toxicity\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>Inside the functional component, add the following states.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Input.js</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isToxic<span class=\"token punctuation\">,</span> setIsToxic<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>isClassifying<span class=\"token punctuation\">,</span> setIsClassifying<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>hasLoaded<span class=\"token punctuation\">,</span> setHasLoaded<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>\n<p><code class=\"language-text\">isToxic</code>: variable to contain the toxicity assessment from model</p>\n</li>\n<li>\n<p><code class=\"language-text\">isClassifying</code>: variable to keep track of the classification process</p>\n</li>\n<li>\n<p><code class=\"language-text\">hasLoaded</code>: variable to keep track whether the model has loaded</p>\n</li>\n</ul>\n</li>\n<li>\n<p>Inside the functional component, insert the useRef hook.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Input.js</span>\r\n<span class=\"token keyword\">const</span> model <span class=\"token operator\">=</span> <span class=\"token function\">useRef</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li><code class=\"language-text\">model</code>: retain the Tensorflow model that will persist for the full lifetime of the Input component</li>\n</ul>\n</li>\n<li>\n<p>Inside the functional component, insert the useEffect hook.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Input.js</span>\r\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">loadModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">const</span> threshold <span class=\"token operator\">=</span> <span class=\"token number\">0.9</span><span class=\"token punctuation\">;</span>\r\n    model<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span>threshold<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token function\">setHasLoaded</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n  <span class=\"token punctuation\">}</span>\r\n  <span class=\"token function\">loadModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>\n<p>Inside the useEffect hook, we load the model through the <code class=\"language-text\">load</code> method from Tensorflow, which accepts an optional parameter <code class=\"language-text\">threshold</code>. Its default value is <code class=\"language-text\">0.85</code>, but we will tweak it to <code class=\"language-text\">0.9</code>.</p>\n</li>\n<li>\n<p>The <code class=\"language-text\">load</code> method also loads the topology and weights, and returns a Promise which is resolved with the model.</p>\n<blockquote>\n<p><strong>Topology</strong>: a file describing the architecture of a model (what operations it uses) and containing references to the model's weights which are stored externally.</p>\n<p><strong>Weights</strong>: binary files containing the model's weights, usually stored in the same directory as topology.</p>\n<p>Source: <a href=\"https://www.tensorflow.org/js/guide/save_load\">Tensorflow</a></p>\n</blockquote>\n</li>\n</ul>\n</li>\n<li>\n<p>Inside the functional component, add the following code at the top of the <code class=\"language-text\">handleSend</code> method.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Input.js</span>\r\n\r\n<span class=\"token comment\">// Set state variables</span>\r\n<span class=\"token function\">setIsSending</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">setIsClassifying</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> predictions <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> model<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">classify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>text<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n<span class=\"token function\">setIsClassifying</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">const</span> toxicityResult <span class=\"token operator\">=</span> predictions<span class=\"token punctuation\">[</span><span class=\"token number\">6</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>results<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>match<span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token comment\">// Set the state variable with the final prediction result</span>\r\n<span class=\"token function\">setIsToxic</span><span class=\"token punctuation\">(</span>toxicityResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>toxicityResult<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n  <span class=\"token comment\">// Move the message sending code here</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>\n<p>The <code class=\"language-text\">classify</code> method takes a parameter of a string array to be evaluated to predict the toxicity. It returns a Promise that is resolved with a <code class=\"language-text\">predictions</code> array.</p>\n</li>\n<li>\n<p>The <code class=\"language-text\">predictions</code> array is an array of objects containing the probabilities for each label. A label is what the TensorFlow model can provide predictions for: <code class=\"language-text\">identity_attack</code>, <code class=\"language-text\">insult</code>, <code class=\"language-text\">obscene</code>, <code class=\"language-text\">severe_toxicity</code>, <code class=\"language-text\">sexual_explicit</code>, <code class=\"language-text\">threat</code>, and <code class=\"language-text\">toxicity</code>. For each toxicity label, there is an array of raw probabilities for each input sentence along with the final prediction. The final prediction can be any of the following:</p>\n<ul>\n<li><code class=\"language-text\">true</code> if the probability of a match exceeds the confidence threshold,</li>\n<li><code class=\"language-text\">false</code> if the probability of <em>not</em> a match exceeds the confidence threshold, and</li>\n<li><code class=\"language-text\">null</code> if neither probability exceeds the threshold.</li>\n</ul>\n</li>\n<li>\n<p>We will be getting the final prediction value from the <code class=\"language-text\">toxicity</code> label, which is the seventh item in the array, hence <code class=\"language-text\">predictions[6].results[0].match</code>.</p>\n</li>\n</ul>\n</li>\n<li>\n<p>We are done with incorporating the TensorFlow model in our code! The next step would be to use the prediction result to show a reminder or not.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// Input.js</span>\r\n\r\n<span class=\"token punctuation\">{</span>\r\n  isToxic <span class=\"token operator\">&amp;&amp;</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ChatReminder</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Pls be kind.</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ChatReminder</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n</ul>\n<p>That is it! If a user attempts to send a toxic message, it will filtered out by the machine learning model and will not be sent. A more positive space has now been created 🌱.</p>\n<h2>Next steps</h2>\n<p>While this is an exciting project, running the model and its classification process in the browser's main thread might pose some blockages in the application. I will be looking into the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API\">Web Workers API - Web APIs | MDN</a> to separate the model's processing logic.</p>\n<p>Here are some useful links that you may want to check out:</p>\n<ul>\n<li><a href=\"https://github.com/gmlunesa/notox\">Notox Source Code</a></li>\n<li><a href=\"https://github.com/gmlunesa/techst/\">Techst</a></li>\n<li><a href=\"https://www.tensorflow.org/js\">TensorFlowJS</a></li>\n</ul>","excerpt":"Along with the growing accessibility of the internet across the world, offensive actions across the…","frontmatter":{"date":"December 15, 2022","dateOriginal":"2022-12-15","title":"Creating a wholesome chat space with Tensorflow","tag":"ML","tags":["Machine Learning","React"],"description":"Creating a wholesome chat space with Tensorflow through the app notox, built by Goldy Mariz Lunesa (gmlunesa)","slug":"/blog/creating-a-wholesome-chat-space-with-tensorflow","featuredImage":{"publicURL":"/static/76e2f1a5d0391c32cb2628d668dff936/featuredImage.png","childrenImageSharp":[{"fluid":{"src":"/static/76e2f1a5d0391c32cb2628d668dff936/ee604/featuredImage.png"}}]}}}},"pageContext":{"id":"c18bebf7-7635-57f8-bd0c-916eca448ed5","frontmatter__slug":"/blog/creating-a-wholesome-chat-space-with-tensorflow","__params":{"frontmatter__slug":"blog"}}},"staticQueryHashes":["321327506"]}